const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/Login-Dhw_Leaz.js","assets/js/react-vendor-D3OtlHN5.js","assets/js/utils-vendor-C4paqCkD.js","assets/js/Home-iYcAD0Pv.js","assets/js/Header-TXnB3V-4.js","assets/js/socket-BCDjj6Tf.js","assets/js/socket-vendor-Ba10ZAmw.js","assets/js/Toast-CCnghxxx.js","assets/js/FilePreview-CPeYa2QP.js","assets/js/Chat-c55iq8NB.js","assets/js/Public-D1Prj5sx.js","assets/js/Settings-BO1GI1EF.js","assets/js/index-B8QdowmW.js","assets/js/index-B9RZvuZ_.js","assets/js/memoryMonitor-DPoURfE2.js","assets/js/networkMonitor-4rwilBaX.js"])))=>i.map(i=>d[i]);
import{r as e,a as t,B as s,b as r,c as n,N as o,R as i}from"./react-vendor-D3OtlHN5.js";import{a,m as c}from"./utils-vendor-C4paqCkD.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const l={},d=function(e,t,s){let r=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),s=e?.nonce||e?.getAttribute("nonce");r=Promise.allSettled(t.map(e=>{if((e=function(e){return"/"+e}(e))in l)return;l[e]=!0;const t=e.endsWith(".css"),r=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${r}`))return;const n=document.createElement("link");return n.rel=t?"stylesheet":"modulepreload",t||(n.as="script"),n.crossOrigin="",n.href=e,s&&n.setAttribute("nonce",s),document.head.appendChild(n),t?new Promise((t,s)=>{n.addEventListener("load",t),n.addEventListener("error",()=>s(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function n(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return r.then(t=>{for(const e of t||[])"rejected"===e.status&&n(e.reason);return e().catch(n)})};var u={exports:{}},h={},m=e,p=Symbol.for("react.element"),f=Symbol.for("react.fragment"),g=Object.prototype.hasOwnProperty,w=m.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,y={key:!0,ref:!0,__self:!0,__source:!0};function b(e,t,s){var r,n={},o=null,i=null;for(r in void 0!==s&&(o=""+s),void 0!==t.key&&(o=""+t.key),void 0!==t.ref&&(i=t.ref),t)g.call(t,r)&&!y.hasOwnProperty(r)&&(n[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===n[r]&&(n[r]=t[r]);return{$$typeof:p,type:e,key:o,ref:i,props:n,_owner:w.current}}h.Fragment=f,h.jsx=b,h.jsxs=b,u.exports=h;var v,j=u.exports,x={},_=t;x.createRoot=_.createRoot,x.hydrateRoot=_.hydrateRoot,function(e){e.Unimplemented="UNIMPLEMENTED",e.Unavailable="UNAVAILABLE"}(v||(v={}));class E extends Error{constructor(e,t,s){super(e),this.message=e,this.code=t,this.data=s}}const k=e=>{const t=e.CapacitorCustomPlatform||null,s=e.Capacitor||{},r=s.Plugins=s.Plugins||{},n=()=>null!==t?t.name:(e=>{var t,s;return(null==e?void 0:e.androidBridge)?"android":(null===(s=null===(t=null==e?void 0:e.webkit)||void 0===t?void 0:t.messageHandlers)||void 0===s?void 0:s.bridge)?"ios":"web"})(e),o=e=>{var t;return null===(t=s.PluginHeaders)||void 0===t?void 0:t.find(t=>t.name===e)},i=new Map;return s.convertFileSrc||(s.convertFileSrc=e=>e),s.getPlatform=n,s.handleError=t=>e.console.error(t),s.isNativePlatform=()=>"web"!==n(),s.isPluginAvailable=e=>{const t=i.get(e);return!!(null==t?void 0:t.platforms.has(n()))||!!o(e)},s.registerPlugin=(e,a={})=>{const c=i.get(e);if(c)return c.proxy;const l=n(),d=o(e);let u;const h=r=>{let n;const o=(...o)=>{const i=(async()=>(!u&&l in a?u=u="function"==typeof a[l]?await a[l]():a[l]:null!==t&&!u&&"web"in a&&(u=u="function"==typeof a.web?await a.web():a.web),u))().then(t=>{const i=((t,r)=>{var n,o;if(!d){if(t)return null===(o=t[r])||void 0===o?void 0:o.bind(t);throw new E(`"${e}" plugin is not implemented on ${l}`,v.Unimplemented)}{const o=null==d?void 0:d.methods.find(e=>r===e.name);if(o)return"promise"===o.rtype?t=>s.nativePromise(e,r.toString(),t):(t,n)=>s.nativeCallback(e,r.toString(),t,n);if(t)return null===(n=t[r])||void 0===n?void 0:n.bind(t)}})(t,r);if(i){const e=i(...o);return n=null==e?void 0:e.remove,e}throw new E(`"${e}.${r}()" is not implemented on ${l}`,v.Unimplemented)});return"addListener"===r&&(i.remove=async()=>n()),i};return o.toString=()=>`${r.toString()}() { [capacitor code] }`,Object.defineProperty(o,"name",{value:r,writable:!1,configurable:!1}),o},m=h("addListener"),p=h("removeListener"),f=(e,t)=>{const s=m({eventName:e},t),r=async()=>{const r=await s;p({eventName:e,callbackId:r},t)},n=new Promise(e=>s.then(()=>e({remove:r})));return n.remove=async()=>{await r()},n},g=new Proxy({},{get(e,t){switch(t){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return d?f:m;case"removeListener":return p;default:return h(t)}}});return r[e]=g,i.set(e,{name:e,proxy:g,platforms:new Set([...Object.keys(a),...d?[l]:[]])}),g},s.Exception=E,s.DEBUG=!!s.DEBUG,s.isLoggingEnabled=!!s.isLoggingEnabled,s},P=(e=>e.Capacitor=k(e))("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}),S=P.registerPlugin;class L{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(e,t){let s=!1;this.listeners[e]||(this.listeners[e]=[],s=!0),this.listeners[e].push(t);const r=this.windowListeners[e];r&&!r.registered&&this.addWindowListener(r),s&&this.sendRetainedArgumentsForEvent(e);return Promise.resolve({remove:async()=>this.removeListener(e,t)})}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t,s){const r=this.listeners[e];if(r)r.forEach(e=>e(t));else if(s){let s=this.retainedEventArguments[e];s||(s=[]),s.push(t),this.retainedEventArguments[e]=s}}hasListeners(e){var t;return!!(null===(t=this.listeners[e])||void 0===t?void 0:t.length)}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:e=>{this.notifyListeners(t,e)}}}unimplemented(e="not implemented"){return new P.Exception(e,v.Unimplemented)}unavailable(e="not available"){return new P.Exception(e,v.Unavailable)}async removeListener(e,t){const s=this.listeners[e];if(!s)return;const r=s.indexOf(t);this.listeners[e].splice(r,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){const t=this.retainedEventArguments[e];t&&(delete this.retainedEventArguments[e],t.forEach(t=>{this.notifyListeners(e,t)}))}}const C=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),I=e=>e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class A extends L{async getCookies(){const e=document.cookie,t={};return e.split(";").forEach(e=>{if(e.length<=0)return;let[s,r]=e.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");s=I(s).trim(),r=I(r).trim(),t[s]=r}),t}async setCookie(e){try{const t=C(e.key),s=C(e.value),r=`; expires=${(e.expires||"").replace("expires=","")}`,n=(e.path||"/").replace("path=",""),o=null!=e.url&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${s||""}${r}; path=${n}; ${o};`}catch(t){return Promise.reject(t)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(t){return Promise.reject(t)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${(new Date).toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}S("CapacitorCookies",{web:()=>new A});const O=(e,t={})=>{const s=Object.assign({method:e.method||"GET",headers:e.headers},t),r=((e={})=>{const t=Object.keys(e),s=Object.keys(e).map(e=>e.toLocaleLowerCase());return s.reduce((s,r,n)=>(s[r]=e[t[n]],s),{})})(e.headers),n=r["content-type"]||"";if("string"==typeof e.data)s.body=e.data;else if(n.includes("application/x-www-form-urlencoded")){const t=new URLSearchParams;for(const[s,r]of Object.entries(e.data||{}))t.set(s,r);s.body=t.toString()}else if(n.includes("multipart/form-data")||e.data instanceof FormData){const t=new FormData;if(e.data instanceof FormData)e.data.forEach((e,s)=>{t.append(s,e)});else for(const s of Object.keys(e.data))t.append(s,e.data[s]);s.body=t;const r=new Headers(s.headers);r.delete("content-type"),s.headers=r}else(n.includes("application/json")||"object"==typeof e.data)&&(s.body=JSON.stringify(e.data));return s};class R extends L{async request(e){const t=O(e,e.webFetchExtra),s=((e,t=!0)=>e?Object.entries(e).reduce((e,s)=>{const[r,n]=s;let o,i;return Array.isArray(n)?(i="",n.forEach(e=>{o=t?encodeURIComponent(e):e,i+=`${r}=${o}&`}),i.slice(0,-1)):(o=t?encodeURIComponent(n):n,i=`${r}=${o}`),`${e}&${i}`},"").substr(1):null)(e.params,e.shouldEncodeUrlParams),r=s?`${e.url}?${s}`:e.url,n=await fetch(r,t),o=n.headers.get("content-type")||"";let i,a,{responseType:c="text"}=n.ok?e:{};switch(o.includes("application/json")&&(c="json"),c){case"arraybuffer":case"blob":a=await n.blob(),i=await(async e=>new Promise((t,s)=>{const r=new FileReader;r.onload=()=>{const e=r.result;t(e.indexOf(",")>=0?e.split(",")[1]:e)},r.onerror=e=>s(e),r.readAsDataURL(e)}))(a);break;case"json":i=await n.json();break;default:i=await n.text()}const l={};return n.headers.forEach((e,t)=>{l[t]=e}),{data:i,headers:l,status:n.status,url:n.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}S("CapacitorHttp",{web:()=>new R});const N={API_URL:"http://192.168.0.103:5000"};const $=new class{constructor(e=100){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return null;const t=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,t),t}set(e,t){if(this.cache.has(e)&&this.cache.delete(e),this.cache.size>=this.capacity){const e=this.cache.keys().next().value;this.cache.delete(e)}this.cache.set(e,t)}delete(e){return this.cache.delete(e)}clear(){this.cache.clear()}size(){return this.cache.size}has(e){return this.cache.has(e)}keys(){return Array.from(this.cache.keys())}stats(){return{size:this.cache.size,capacity:this.capacity,usage:(this.cache.size/this.capacity*100).toFixed(2)+"%"}}}(200);const T=new class{constructor(e="BeOneCache",t=1){this.dbName=e,this.version=t,this.db=null}async init(){return new Promise((e,t)=>{const s=indexedDB.open(this.dbName,this.version);s.onerror=()=>t(s.error),s.onsuccess=()=>{this.db=s.result,e(this.db)},s.onupgradeneeded=e=>{const t=e.target.result;if(!t.objectStoreNames.contains("files")){const e=t.createObjectStore("files",{keyPath:"id"});e.createIndex("created_at","created_at",{unique:!1}),e.createIndex("user_id","user_id",{unique:!1})}if(!t.objectStoreNames.contains("messages")){const e=t.createObjectStore("messages",{keyPath:"id"});e.createIndex("conversation_id","conversation_id",{unique:!1}),e.createIndex("created_at","created_at",{unique:!1})}if(!t.objectStoreNames.contains("cache")){t.createObjectStore("cache",{keyPath:"key"}).createIndex("expires_at","expires_at",{unique:!1})}}})}async get(e,t){return this.db||await this.init(),new Promise((s,r)=>{const n=this.db.transaction([e],"readonly").objectStore(e).get(t);n.onsuccess=()=>s(n.result),n.onerror=()=>r(n.error)})}async set(e,t){return this.db||await this.init(),new Promise((s,r)=>{const n=this.db.transaction([e],"readwrite").objectStore(e).put(t);n.onsuccess=()=>s(n.result),n.onerror=()=>r(n.error)})}async delete(e,t){return this.db||await this.init(),new Promise((s,r)=>{const n=this.db.transaction([e],"readwrite").objectStore(e).delete(t);n.onsuccess=()=>s(),n.onerror=()=>r(n.error)})}async getAll(e){return this.db||await this.init(),new Promise((t,s)=>{const r=this.db.transaction([e],"readonly").objectStore(e).getAll();r.onsuccess=()=>t(r.result),r.onerror=()=>s(r.error)})}async clear(e){return this.db||await this.init(),new Promise((t,s)=>{const r=this.db.transaction([e],"readwrite").objectStore(e).clear();r.onsuccess=()=>t(),r.onerror=()=>s(r.error)})}async cacheResponse(e,t,s=36e5){const r={key:e,data:t,expires_at:Date.now()+s,created_at:Date.now()};return this.set("cache",r)}async getCachedResponse(e){const t=await this.get("cache",e);return t?t.expires_at<Date.now()?(await this.delete("cache",e),null):t.data:null}async cleanExpiredCache(){return this.db||await this.init(),new Promise((e,t)=>{const s=this.db.transaction(["cache"],"readwrite").objectStore("cache").index("expires_at"),r=IDBKeyRange.upperBound(Date.now()),n=s.openCursor(r);let o=0;n.onsuccess=t=>{const s=t.target.result;s?(s.delete(),o++,s.continue()):e(o)},n.onerror=()=>t(n.error)})}async getStats(){this.db||await this.init();const e={},t=["files","messages","cache"];for(const s of t){const t=await this.getAll(s);e[s]={count:t.length,size:new Blob([JSON.stringify(t)]).size}}return e}};T.init().catch(e=>{}),setInterval(()=>{T.cleanExpiredCache().catch(e=>{})},6e5);class D{constructor(e=1e4,t=3){this.size=e,this.hashCount=t,this.bits=new Uint8Array(Math.ceil(e/8))}hash(e,t=0){let s=t;for(let r=0;r<e.length;r++)s=(s<<5)-s+e.charCodeAt(r),s&=s;return Math.abs(s)%this.size}add(e){const t=String(e);for(let s=0;s<this.hashCount;s++){const e=this.hash(t,s),r=Math.floor(e/8),n=e%8;this.bits[r]|=1<<n}}mightContain(e){const t=String(e);for(let s=0;s<this.hashCount;s++){const e=this.hash(t,s),r=Math.floor(e/8),n=e%8;if(!(this.bits[r]&1<<n))return!1}return!0}clear(){this.bits=new Uint8Array(Math.ceil(this.size/8))}stats(){let e=0;for(let t=0;t<this.bits.length;t++)for(let s=0;s<8;s++)this.bits[t]&1<<s&&e++;return{size:this.size,hashCount:this.hashCount,setBits:e,fillRate:(e/this.size*100).toFixed(2)+"%"}}serialize(){return{size:this.size,hashCount:this.hashCount,bits:Array.from(this.bits)}}static deserialize(e){const t=new D(e.size,e.hashCount);return t.bits=new Uint8Array(e.bits),t}}const U=new D(5e4,4),z=()=>{if(P.isNativePlatform()){return localStorage.getItem("apiUrl")||N.API_URL}{const e=window.location.protocol;return`${e}//${window.location.hostname}${"https:"===e?"":":5000"}`}},F=(()=>{if(P.isNativePlatform()){return localStorage.getItem("apiUrl")||N.API_URL}{const e=window.location.protocol;return`${e}//${window.location.hostname}${"https:"===e?"":":5000"}`}})(),B=a.create({baseURL:F,timeout:P.isNativePlatform()?3e4:15e3,headers:{"Content-Type":"application/json"},maxRedirects:3,maxContentLength:52428800,maxBodyLength:52428800,validateStatus:e=>e>=200&&e<500}),M=()=>{const e=z();return B.defaults.baseURL=e,e},q=new Map,V=P.isNativePlatform()?3e4:5e3;B.interceptors.request.use(e=>{const t=localStorage.getItem("token");return t&&(e.headers.Authorization=`Bearer ${t}`),e.data instanceof FormData?delete e.headers["Content-Type"]:e.headers["Content-Type"]="application/json",P.isNativePlatform()&&(e.headers["Accept-Encoding"]="gzip, deflate"),e},e=>Promise.reject(e)),B.interceptors.response.use(e=>e,async e=>{const t=e.config;return P.isNativePlatform()&&!t._retry&&("ECONNABORTED"===e.code||"ERR_NETWORK"===e.code||!e.response)&&(t._retry=!0,t._retryCount=t._retryCount||0,t._retryCount<2)?(t._retryCount+=1,await new Promise(e=>setTimeout(e,500*t._retryCount)),B(t)):(401===e.response?.status&&(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login"),Promise.reject(e))});const W={async getFiles(e=!0){const t="files_list";if(e){const e=$.get(t);if(e)return e;try{const e=await T.getCachedResponse(t);if(e)return $.set(t,e),e}catch(r){}}const s=(await B.get("/api/files")).data.files;return e&&($.set(t,s),T.cacheResponse(t,s,6e4).catch(()=>{}),s.forEach(e=>{U.add(e.id)})),s},async getPublicFiles(e=!0){const t=async()=>(await B.get("/api/files/public")).data.files;return e?(async(e,t,s=V)=>{const r=Date.now(),n=q.get(e);if(n&&r-n.timestamp<s)return n.data;const o=await t();return q.set(e,{data:o,timestamp:r}),setTimeout(()=>{q.delete(e)},s),o})("public-files",t):t()},async toggleVisibility(e){const t=await B.patch(`/api/files/${e}/visibility`);q.delete("files"),q.delete("public-files"),q.delete("files_list"),$.delete("files_list"),$.delete("public-files");try{await T.deleteCachedResponse("files_list"),await T.deleteCachedResponse("public-files")}catch(s){}return t.data},async deleteFile(e){const t=await B.delete(`/api/files/${e}`);q.delete("files"),q.delete("public-files"),q.delete("files_list"),$.delete("files_list"),$.delete("public-files");try{await T.deleteCachedResponse("files_list"),await T.deleteCachedResponse("public-files")}catch(s){}return U.clear(),t.data},getDownloadUrl(e){const t=localStorage.getItem("token"),s=`/api/files/${e}/download`,r=t?`${s}?token=${encodeURIComponent(t)}`:s;return z()+r},getPreviewUrl(e){const t=localStorage.getItem("token"),s=`/api/files/${e}/preview`,r=t?`${s}?token=${encodeURIComponent(t)}`:s;return z()+r},getThumbnailUrl(e){const t=localStorage.getItem("token"),s=`/api/files/${e}/thumbnail`,r=t?`${s}?token=${encodeURIComponent(t)}`:s;return z()+r},clearCache(){q.clear(),$.clear();try{T.clear().catch(()=>{})}catch(e){}}},H=e.createContext(null),J=()=>{const t=e.useContext(H);if(!t)throw new Error("useAuth 必须在 AuthProvider 内使用");return t},K=({children:t})=>{const[s,r]=e.useState(null),[n,o]=e.useState(null),[i,a]=e.useState(!0);e.useEffect(()=>{try{const e=localStorage.getItem("token"),t=localStorage.getItem("user");e&&t&&!(void 0===t||"undefined"===t||null===t||"null"===t)?(o(e),r(JSON.parse(t)),B.defaults.headers.common.Authorization=`Bearer ${e}`,"https:"===window.location.protocol&&(document.cookie=`token=${e}; path=/; secure; samesite=strict`)):(localStorage.removeItem("token"),localStorage.removeItem("user"))}catch{localStorage.removeItem("token"),localStorage.removeItem("user")}finally{a(!1)}},[]);return j.jsx(H.Provider,{value:{user:s,token:n,login:async(e,t)=>{try{M();const s=await B.post("/api/auth/login",{username:e,password:t}),{token:n,user:i}=s.data;return localStorage.removeItem("token"),localStorage.removeItem("user"),delete B.defaults.headers.common.Authorization,o(n),r(i),localStorage.setItem("token",n),localStorage.setItem("user",JSON.stringify(i)),B.defaults.headers.common.Authorization=`Bearer ${n}`,"https:"===window.location.protocol&&(document.cookie=`token=${n}; path=/; secure; samesite=strict`),{success:!0}}catch(s){return{success:!1,error:s.response?.data?.error||"登录失败"}}},guestLogin:async()=>{try{M();const e=await B.post("/api/auth/guest-login"),{token:t,user:s}=e.data;return localStorage.removeItem("token"),localStorage.removeItem("user"),delete B.defaults.headers.common.Authorization,o(t),r(s),localStorage.setItem("token",t),localStorage.setItem("user",JSON.stringify(s)),B.defaults.headers.common.Authorization=`Bearer ${t}`,"https:"===window.location.protocol&&(document.cookie=`token=${t}; path=/; secure; samesite=strict`),{success:!0}}catch(e){return{success:!1,error:e.response?.data?.error||"游客登录失败"}}},logout:()=>{o(null),r(null),localStorage.removeItem("token"),localStorage.removeItem("user"),delete B.defaults.headers.common.Authorization,"https:"===window.location.protocol&&(document.cookie="token=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT; secure; samesite=strict")},loading:i},children:t})};function G({size:e=100,animate:t=!0,className:s=""}){return j.jsx(c.div,{className:`relative ${s}`,style:{width:e,height:e},animate:t?{rotate:360}:{},transition:t?{duration:8,repeat:1/0,ease:"linear"}:{},children:j.jsxs("svg",{viewBox:"0 0 100 100",xmlns:"http://www.w3.org/2000/svg",className:"w-full h-full",children:[j.jsx("defs",{children:j.jsx("clipPath",{id:"circle-clip",children:j.jsx("circle",{cx:"50",cy:"50",r:"48"})})}),j.jsx("circle",{cx:"50",cy:"50",r:"48",fill:"#fff"}),j.jsx("g",{clipPath:"url(#circle-clip)",children:j.jsx("path",{d:"M 50 2 A 48 48 0 0 1 50 98 A 24 24 0 0 1 50 50 A 24 24 0 0 0 50 2 Z",fill:"#000"})}),j.jsx("circle",{cx:"50",cy:"50",r:"48",fill:"none",stroke:"#000",strokeWidth:"2"}),j.jsx("circle",{cx:"50",cy:"75",r:"8",fill:"#fff"}),j.jsx("circle",{cx:"50",cy:"25",r:"8",fill:"#000"})]})})}class Y extends e.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){}handleReload=()=>{window.location.reload()};render(){return this.state.hasError?j.jsx("div",{className:"min-h-screen bg-taiji-gray-100 flex items-center justify-center p-4",children:j.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-8 max-w-md w-full text-center",children:[j.jsx("div",{className:"mb-6",children:j.jsx(G,{size:80,animate:!0})}),j.jsx("h1",{className:"text-2xl font-bold text-taiji-black mb-4",children:"页面加载失败"}),j.jsx("p",{className:"text-taiji-gray-600 mb-6",children:this.state.error?.message||"发生了一个错误"}),j.jsx("button",{onClick:this.handleReload,className:"w-full px-6 py-3 bg-taiji-black text-white rounded-lg hover:bg-taiji-gray-800 transition-colors font-medium",children:"重新加载"})]})}):this.props.children}}function Z({message:e="加载中..."}){return j.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px]",children:[j.jsx(G,{size:100,animate:!0}),j.jsx("p",{className:"mt-4 text-taiji-gray-500",children:e})]})}const Q=e.memo(()=>j.jsx("div",{className:"flex items-center justify-center min-h-screen bg-taiji-gray-100",children:j.jsx("div",{className:"w-12 h-12 border-4 border-taiji-black border-t-transparent rounded-full animate-spin"})}));Q.displayName="MinimalLoader";const X=e.lazy(()=>d(()=>import("./Login-Dhw_Leaz.js"),__vite__mapDeps([0,1,2]))),ee=e.lazy(()=>d(()=>import("./Home-iYcAD0Pv.js"),__vite__mapDeps([3,1,4,2,5,6,7,8]))),te=e.lazy(()=>d(()=>import("./Chat-c55iq8NB.js"),__vite__mapDeps([9,1,4,2,5,6,7]))),se=e.lazy(()=>d(()=>import("./Public-D1Prj5sx.js"),__vite__mapDeps([10,1,4,2,8,5,6]))),re=e.lazy(()=>d(()=>import("./Settings-BO1GI1EF.js"),__vite__mapDeps([11,1,4,2])));function ne(){const{user:e,loading:t}=J(),s=P.isNativePlatform();return t?j.jsx(Z,{message:"加载中..."}):s?e?j.jsx(o,{to:"/files",replace:!0}):j.jsx(o,{to:"/login",replace:!0}):j.jsx(o,{to:"/public",replace:!0})}function oe({children:e}){const{user:t,loading:s}=J();return s?j.jsx(Z,{message:"加载中..."}):t?e:j.jsx(o,{to:"/login",replace:!0})}function ie({children:e}){const{user:t,loading:s}=J();return s?j.jsx(Z,{message:"加载中..."}):t?j.jsx(o,{to:"/files",replace:!0}):e}function ae(){return e.useEffect(()=>{"undefined"!=typeof requestIdleCallback?requestIdleCallback(()=>{d(()=>import("./Login-Dhw_Leaz.js"),__vite__mapDeps([0,1,2])),d(()=>import("./Home-iYcAD0Pv.js"),__vite__mapDeps([3,1,4,2,5,6,7,8]))}):setTimeout(()=>{d(()=>import("./Login-Dhw_Leaz.js"),__vite__mapDeps([0,1,2])),d(()=>import("./Home-iYcAD0Pv.js"),__vite__mapDeps([3,1,4,2,5,6,7,8]))},1e3),P.isNativePlatform()&&Promise.all([d(()=>import("./index-B8QdowmW.js"),__vite__mapDeps([12,1,2])),d(()=>import("./index-B9RZvuZ_.js"),__vite__mapDeps([13,1,2]))]).then(([{StatusBar:e,Style:t},{Keyboard:s,KeyboardResize:r}])=>{e.setStyle({style:t.Light}),e.setBackgroundColor({color:"#FFFFFF"}),s.setResizeMode({mode:r.Native}),s.setScroll({isDisabled:!0})}).catch(()=>{})},[]),j.jsx(Y,{children:j.jsx(s,{children:j.jsx(K,{children:j.jsx(e.Suspense,{fallback:j.jsx(Q,{}),children:j.jsxs(r,{children:[j.jsx(n,{path:"/",element:j.jsx(ne,{})}),j.jsx(n,{path:"/public",element:j.jsx(se,{})}),j.jsx(n,{path:"/login",element:j.jsx(ie,{children:j.jsx(X,{})})}),j.jsx(n,{path:"/files",element:j.jsx(oe,{children:j.jsx(ee,{})})}),j.jsx(n,{path:"/chat",element:j.jsx(oe,{children:j.jsx(te,{})})}),j.jsx(n,{path:"/settings",element:j.jsx(oe,{children:j.jsx(re,{})})}),j.jsx(n,{path:"*",element:j.jsx(ne,{})})]})})})})})}(()=>{try{const e=["user","token"];for(const t of e){const e=localStorage.getItem(t);if(void 0!==e&&"undefined"!==e&&"null"!==e){if("user"===t&&"string"==typeof e)try{JSON.parse(e)}catch{localStorage.removeItem(t)}}else localStorage.removeItem(t)}}catch{}})(),window.addEventListener("error",()=>{}),window.addEventListener("unhandledrejection",()=>{}),"undefined"!=typeof requestIdleCallback?requestIdleCallback(()=>{d(()=>import("./memoryMonitor-DPoURfE2.js"),__vite__mapDeps([14,1,2])),d(()=>import("./networkMonitor-4rwilBaX.js"),__vite__mapDeps([15,1,2]))}):setTimeout(()=>{d(()=>import("./memoryMonitor-DPoURfE2.js"),__vite__mapDeps([14,1,2])),d(()=>import("./networkMonitor-4rwilBaX.js"),__vite__mapDeps([15,1,2]))},2e3),"serviceWorker"in navigator&&window.addEventListener("load",()=>{setTimeout(()=>{navigator.serviceWorker.register("/sw.js").catch(()=>{})},1e3)}),x.createRoot(document.getElementById("root")).render(j.jsx(i.StrictMode,{children:j.jsx(ae,{})}));export{N as A,P as C,Z as L,G as T,L as W,d as _,W as a,B as b,O as c,j,S as r,J as u};
