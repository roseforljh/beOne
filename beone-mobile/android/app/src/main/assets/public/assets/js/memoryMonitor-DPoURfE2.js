import{C as e,a as t}from"./index-uVwVOvxz.js";import"./react-vendor-D3OtlHN5.js";import"./utils-vendor-C4paqCkD.js";const r=new class{constructor(){this.isMonitoring=!1,this.checkInterval=3e4,this.highMemoryThreshold=.8,this.criticalMemoryThreshold=.9,this.intervalId=null}start(){e.isNativePlatform()&&!this.isMonitoring&&(this.isMonitoring=!0,this.intervalId=setInterval(()=>{this.checkMemory()},this.checkInterval),this.checkMemory())}stop(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null),this.isMonitoring=!1}checkMemory(){if(!performance.memory)return;const e=performance.memory.usedJSHeapSize,t=performance.memory.totalJSHeapSize,r=performance.memory.jsHeapSizeLimit,o=e/t;(e/1048576).toFixed(2),(t/1048576).toFixed(2),(r/1048576).toFixed(2);o>=this.criticalMemoryThreshold?this.emergencyCleanup():o>=this.highMemoryThreshold&&this.regularCleanup()}regularCleanup(){t&&t.clearCache&&t.clearCache(),global.gc&&global.gc()}emergencyCleanup(){this.regularCleanup();try{const e=[];for(let t=0;t<localStorage.length;t++){const r=localStorage.key(t);r&&(r.startsWith("temp_")||r.startsWith("cache_"))&&e.push(r)}e.forEach(e=>localStorage.removeItem(e))}catch(e){}window.showToast&&window.showToast("内存使用率过高，已自动清理缓存","warning")}getMemoryStatus(){if(!performance.memory)return null;const e=performance.memory.usedJSHeapSize,t=performance.memory.totalJSHeapSize,r=performance.memory.jsHeapSizeLimit;return{used:(e/1048576).toFixed(2)+" MB",total:(t/1048576).toFixed(2)+" MB",limit:(r/1048576).toFixed(2)+" MB",usagePercent:(e/t*100).toFixed(1)+"%"}}};e.isNativePlatform()&&setTimeout(()=>{r.start()},5e3);export{r as memoryMonitor};
