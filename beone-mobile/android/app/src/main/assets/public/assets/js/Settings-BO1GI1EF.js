import{u as e,j as a,T as t,b as i}from"./index-uVwVOvxz.js";import{r as s}from"./react-vendor-D3OtlHN5.js";import{H as r}from"./Header-TXnB3V-4.js";import{m as l}from"./utils-vendor-C4paqCkD.js";function d(){const{user:d,logout:n}=e(),[c,o]=s.useState("username"),[m,x]=s.useState(""),[p,u]=s.useState(!1),[b,j]=s.useState(""),[h,y]=s.useState(""),[g,v]=s.useState(""),[f,N]=s.useState(""),[w,k]=s.useState(""),[S,C]=s.useState(!1),[T,H]=s.useState(""),[q,z]=s.useState(""),D=d?.is_guest;return a.jsxs("div",{className:"min-h-screen bg-taiji-gray-100",children:[a.jsx(r,{}),a.jsx("main",{className:"max-w-4xl mx-auto px-3 md:px-4 py-4 md:py-8",style:{paddingTop:"calc(60px + env(safe-area-inset-top))"},children:a.jsxs(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[a.jsxs("div",{className:"mb-6 md:mb-8",children:[a.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-taiji-black mb-2",children:"è´¦å·è®¾ç½®"}),a.jsx("p",{className:"text-sm md:text-base text-taiji-gray-500",children:D?"æ¸¸å®¢æ¨¡å¼ä¸‹æ— æ³•ä¿®æ”¹è´¦å·ä¿¡æ¯":"ç®¡ç†æ‚¨çš„è´¦å·ä¿¡æ¯"})]}),D?a.jsxs(l.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-taiji-white rounded-xl md:rounded-2xl shadow-lg border-2 border-taiji-gray-200 p-8 text-center",children:[a.jsx("div",{className:"mb-6",children:a.jsx(t,{size:80,animate:!0})}),a.jsx("h2",{className:"text-xl md:text-2xl font-bold text-taiji-black mb-4",children:"ğŸ‘¤ æ¸¸å®¢æ¨¡å¼"}),a.jsxs("p",{className:"text-taiji-gray-600 mb-6",children:["æ¸¸å®¢è´¦å·æ˜¯ä¸´æ—¶è´¦å·ï¼Œæ— æ³•ä¿®æ”¹ç”¨æˆ·åå’Œå¯†ç ã€‚",a.jsx("br",{}),"å¦‚éœ€å®Œæ•´åŠŸèƒ½ï¼Œè¯·é€€å‡ºæ¸¸å®¢æ¨¡å¼å¹¶ä½¿ç”¨æ­£å¼è´¦å·ç™»å½•ã€‚"]}),a.jsx(l.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:n,className:"px-6 py-3 bg-taiji-black text-taiji-white rounded-lg hover:bg-taiji-gray-800 transition-colors font-medium",children:"é€€å‡ºæ¸¸å®¢æ¨¡å¼"})]}):a.jsxs("div",{className:"bg-taiji-white rounded-xl md:rounded-2xl shadow-lg border-2 border-taiji-gray-200 overflow-hidden",children:[a.jsxs("div",{className:"flex border-b-2 border-taiji-gray-200",children:[a.jsx("button",{onClick:()=>o("username"),className:"flex-1 px-4 py-3 md:py-4 font-medium transition-colors "+("username"===c?"bg-taiji-black text-taiji-white":"text-taiji-gray-600 hover:bg-taiji-gray-100"),children:"ä¿®æ”¹ç”¨æˆ·å"}),a.jsx("button",{onClick:()=>o("password"),className:"flex-1 px-4 py-3 md:py-4 font-medium transition-colors "+("password"===c?"bg-taiji-black text-taiji-white":"text-taiji-gray-600 hover:bg-taiji-gray-100"),children:"ä¿®æ”¹å¯†ç "})]}),a.jsxs("div",{className:"p-4 md:p-8",children:["username"===c&&a.jsxs(l.form,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},onSubmit:async e=>{if(e.preventDefault(),j(""),y(""),!m.trim()||m.trim().length<2)j("ç”¨æˆ·åè‡³å°‘éœ€è¦2ä¸ªå­—ç¬¦");else{u(!0);try{const e=await i.patch("/api/user/username",{newUsername:m.trim()});y("ç”¨æˆ·åä¿®æ”¹æˆåŠŸï¼"),x("");const a={...d,username:e.data.username};localStorage.setItem("user",JSON.stringify(a)),setTimeout(()=>{window.location.reload()},1500)}catch(a){j(a.response?.data?.error||"ä¿®æ”¹å¤±è´¥")}u(!1)}},className:"space-y-4 md:space-y-6",children:[a.jsxs("div",{className:"flex items-center gap-4 p-4 bg-taiji-gray-100 rounded-lg",children:[a.jsx(t,{size:40,animate:!1}),a.jsxs("div",{children:[a.jsx("p",{className:"text-sm text-taiji-gray-600",children:"å½“å‰ç”¨æˆ·å"}),a.jsx("p",{className:"text-lg font-bold text-taiji-black",children:d?.username})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-taiji-black mb-2",children:"æ–°ç”¨æˆ·å"}),a.jsx("input",{type:"text",value:m,onChange:e=>x(e.target.value),className:"input-field",placeholder:"è¾“å…¥æ–°ç”¨æˆ·å",required:!0})]}),b&&a.jsx(l.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-lg text-sm",children:b}),h&&a.jsx(l.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-green-50 border border-green-200 text-green-600 px-4 py-3 rounded-lg text-sm",children:h}),a.jsx(l.button,{type:"submit",disabled:p,whileHover:{scale:1.02},whileTap:{scale:.98},className:"w-full btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:p?"ä¿®æ”¹ä¸­...":"ç¡®è®¤ä¿®æ”¹"})]}),"password"===c&&a.jsxs(l.form,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},onSubmit:async e=>{if(e.preventDefault(),H(""),z(""),g&&f&&w)if(f.length<6)H("æ–°å¯†ç è‡³å°‘éœ€è¦6ä¸ªå­—ç¬¦");else if(f===w){C(!0);try{await i.patch("/api/user/password",{currentPassword:g,newPassword:f}),z("å¯†ç ä¿®æ”¹æˆåŠŸï¼è¯·é‡æ–°ç™»å½•"),v(""),N(""),k(""),setTimeout(()=>{n()},2e3)}catch(a){H(a.response?.data?.error||"ä¿®æ”¹å¤±è´¥")}C(!1)}else H("ä¸¤æ¬¡è¾“å…¥çš„æ–°å¯†ç ä¸ä¸€è‡´");else H("è¯·å¡«å†™æ‰€æœ‰å­—æ®µ")},className:"space-y-4 md:space-y-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-taiji-black mb-2",children:"å½“å‰å¯†ç "}),a.jsx("input",{type:"password",value:g,onChange:e=>v(e.target.value),className:"input-field",placeholder:"è¾“å…¥å½“å‰å¯†ç ",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-taiji-black mb-2",children:"æ–°å¯†ç "}),a.jsx("input",{type:"password",value:f,onChange:e=>N(e.target.value),className:"input-field",placeholder:"è¾“å…¥æ–°å¯†ç ï¼ˆè‡³å°‘6ä¸ªå­—ç¬¦ï¼‰",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-taiji-black mb-2",children:"ç¡®è®¤æ–°å¯†ç "}),a.jsx("input",{type:"password",value:w,onChange:e=>k(e.target.value),className:"input-field",placeholder:"å†æ¬¡è¾“å…¥æ–°å¯†ç ",required:!0})]}),T&&a.jsx(l.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-lg text-sm",children:T}),q&&a.jsx(l.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-green-50 border border-green-200 text-green-600 px-4 py-3 rounded-lg text-sm",children:q}),a.jsx(l.button,{type:"submit",disabled:S,whileHover:{scale:1.02},whileTap:{scale:.98},className:"w-full btn-primary disabled:opacity-50 disabled:cursor-not-allowed",children:S?"ä¿®æ”¹ä¸­...":"ç¡®è®¤ä¿®æ”¹"})]})]})]})]})})]})}export{d as default};
