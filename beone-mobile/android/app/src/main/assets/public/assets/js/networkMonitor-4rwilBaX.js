import"./index-uVwVOvxz.js";import"./react-vendor-D3OtlHN5.js";import"./utils-vendor-C4paqCkD.js";const n=new class{constructor(){this.isMonitoring=!1,this.currentStatus=null,this.listeners=[],this.networkQuality="high"}async start(){if(!this.isMonitoring){this.isMonitoring=!0;try{const n=navigator.connection||navigator.mozConnection||navigator.webkitConnection,t={connected:navigator.onLine,connectionType:n?.effectiveType||(navigator.onLine?"wifi":"none")};this.handleStatusChange(t),window.addEventListener("online",this.handleOnlineEvent.bind(this)),window.addEventListener("offline",this.handleOfflineEvent.bind(this)),n&&n.addEventListener("change",this.handleConnectionChange.bind(this))}catch(n){}}}handleOnlineEvent(){const n=navigator.connection||navigator.mozConnection||navigator.webkitConnection,t={connected:!0,connectionType:n?.effectiveType||"wifi"};this.handleStatusChange(t)}handleOfflineEvent(){this.handleStatusChange({connected:!1,connectionType:"none"})}handleConnectionChange(){const n=navigator.connection||navigator.mozConnection||navigator.webkitConnection,t={connected:navigator.onLine,connectionType:n?.effectiveType||"unknown"};this.handleStatusChange(t)}stop(){if(!this.isMonitoring)return;window.removeEventListener("online",this.handleOnlineEvent),window.removeEventListener("offline",this.handleOfflineEvent);const n=navigator.connection||navigator.mozConnection||navigator.webkitConnection;n&&n.removeEventListener("change",this.handleConnectionChange),this.isMonitoring=!1}handleStatusChange(n){const t=this.currentStatus;this.currentStatus=n,this.updateNetworkQuality(n),this.notifyListeners(n,t),this.adjustAppBehavior(n)}updateNetworkQuality(n){n.connected?"wifi"===n.connectionType||"4g"===n.connectionType?this.networkQuality="high":"3g"===n.connectionType||"cellular"===n.connectionType?this.networkQuality="medium":"2g"===n.connectionType||"slow-2g"===n.connectionType?this.networkQuality="low":this.networkQuality="medium":this.networkQuality="offline"}adjustAppBehavior(n){n.connected?this.handleOnline(n):this.handleOffline()}handleOffline(){window.isOffline=!0,window.showToast&&window.showToast("网络已断开，部分功能不可用","error"),window.stopAutoRefresh&&window.stopAutoRefresh()}handleOnline(n){window.isOffline=!1,"wifi"===n.connectionType||"4g"===n.connectionType?(window.imageQuality="high",window.videoQuality="high"):"3g"===n.connectionType||"cellular"===n.connectionType?(window.imageQuality="medium",window.videoQuality="medium"):"2g"!==n.connectionType&&"slow-2g"!==n.connectionType||(window.imageQuality="low",window.videoQuality="low"),window.showToast&&window.showToast("网络已连接","success"),window.startAutoRefresh&&window.startAutoRefresh()}addListener(n){this.listeners.push(n),this.currentStatus&&n(this.currentStatus,null)}removeListener(n){this.listeners=this.listeners.filter(t=>t!==n)}notifyListeners(n,t){this.listeners.forEach(e=>{try{e(n,t)}catch(i){}})}getStatus(){return this.currentStatus}getQuality(){return this.networkQuality}isOnline(){return this.currentStatus?.connected||!1}isWiFi(){return"wifi"===this.currentStatus?.connectionType}isCellular(){const n=this.currentStatus?.connectionType;return"cellular"===n||"2g"===n||"3g"===n||"4g"===n}};"undefined"!=typeof window&&n.start();export{n as networkMonitor};
